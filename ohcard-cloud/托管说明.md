服务器托管
在 MCP.so 上托管 MCP 服务器

很高兴知道
在将 MCP 服务器托管到 MCP.so 之前，请务必了解：

您的 MCP 服务器应该是开源的，具有商业用途友好的许可证，如 MIT、Apache 等。
您的 MCP 服务器不会读取本地数据，如文件、本地数据库等。
您的 MCP 服务器当前使用传输运行，不适合并发呼叫。stdio
托管您的 MCP 服务器
按照以下步骤在 MCP.so 上托管您的 MCP 服务器

安装 SDK 方式@chatmcp

npm install @chatmcp/sdk
修改参数的传递方式

// before: get params from env and set as global params

// Retrieve the Perplexity API key from environment variables
// const PERPLEXITY_API_KEY = process.env.PERPLEXITY_API_KEY;
// if (!PERPLEXITY_API_KEY) {
//   console.error("Error: PERPLEXITY_API_KEY environment variable is required");
//   process.exit(1);
// }

// after: get params from env or command line, set as global params
import { getParamValue, getAuthValue } from "@chatmcp/sdk/utils/index.js";

const perplexityApiKey = getParamValue("perplexity_api_key") || "";

const mode = getParamValue("mode") || "stdio";
const port = getParamValue("port") || 9593;
const endpoint = getParamValue("endpoint") || "/rest";

server.setRequestHandler(CallToolRequestSchema, async (request) => {
  try {
    // before: use global params

    // after: get auth params from request, if global params not set
    const apiKey =
      perplexityApiKey || getAuthValue(request, "PERPLEXITY_API_KEY");
    if (!apiKey) {
      throw new Error("PERPLEXITY_API_KEY not set");
    }
     
    const { name, arguments: args } = request.params;
    if (!args) {
      throw new Error("No arguments provided");
    }
    switch (name) {
      case "perplexity_ask": {
        if (!Array.isArray(args.messages)) {
          throw new Error(
            "Invalid arguments for perplexity_ask: 'messages' must be an array"
          );
        }
     
        const messages = args.messages;
     
        // before: use global params in every function
        // const result = await performChatCompletion(
        //   messages,
        //   "sonar-pro"
        // );
     
        // after: pass params to every function
        const result = await performChatCompletion(
          apiKey,
          messages,
          "sonar-pro"
        );
     
        return {
          content: [{ type: "text", text: result }],
          isError: false,
        };
      }
      // ...
    }

  } catch (error) {
    // Return error details in the response
    return {
      content: [
        {
          type: "text",
          text: `Error: ${
            error instanceof Error ? error.message : String(error)
          }`,
        },
      ],
      isError: true,
    };
  }
});
添加 rest 服务器传输

import { RestServerTransport } from "@chatmcp/sdk/server/rest.js";

async function runServer() {
  try {
    // after: MCP Server run with rest transport and stdio transport
    if (mode === "rest") {
      const transport = new RestServerTransport({
        port,
        endpoint,
      });
      await server.connect(transport);

      await transport.startServer();
     
      return;
    }
     
    // before: MCP Server only run with stdio transport
    const transport = new StdioServerTransport();
    await server.connect(transport);
    console.error(
      "Perplexity MCP Server running on stdio with Ask, Research, and Reason tools"
    );

  } catch (error) {
    console.error("Fatal error running server:", error);
    process.exit(1);
  }
}
加Dockerfile

FROM node:22.12-alpine AS builder

COPY ./ /app

WORKDIR /app

RUN --mount=type=cache,target=/root/.npm npm install

FROM node:22.12-alpine AS release

WORKDIR /app

COPY --from=builder /app/dist /app/dist
COPY --from=builder /app/package.json /app/package.json
COPY --from=builder /app/package-lock.json /app/package-lock.json

ENV NODE_ENV=production

RUN npm ci --ignore-scripts --omit-dev

ENTRYPOINT ["node", "dist/index.js"]
加chatmcp.yaml


params:
  type: object
  properties:
    PERPLEXITY_API_KEY:
      type: string
      description: Perplexity Sonar API Key
  required:
    - PERPLEXITY_API_KEY

rest:
  name: perplexity
  port: 9593
  endpoint: /rest

npx:
  command:
    | PERPLEXITY_API_KEY={PERPLEXITY_API_KEY} npx -y server-perplexity-ask
  config:
    | {
        "mcpServers": {
          "perplexity-ask": {
            "command": "npx",
            "args": [
              "-y",
              "server-perplexity-ask"
            ],
            "env": {
              "PERPLEXITY_API_KEY": "YOUR_API_KEY_HERE"
            }
          }
        }
      }

docker:
  command:
    | docker run -i --rm -e PERPLEXITY_API_KEY={PERPLEXITY_API_KEY} mcp/perplexity-ask
  config:
    | {
        "mcpServers": {
          "perplexity-ask": {
            "command": "docker",
            "args": [
              "run",
              "-i",
              "--rm",
              "-e",
              "PERPLEXITY_API_KEY",
              "mcp/perplexity-ask"
            ],
            "env": {
              "PERPLEXITY_API_KEY": "YOUR_API_KEY_HERE"
            }
          }
        }
      }
将您的 MCP 服务器代码上传到 Github

将您的 MCP 服务器提交到 MCP.so

我们将审核您的 MCP 服务器，以确保其已准备好进行托管。

托管后，您将在 MCP Playground 上看到 MCP 服务器。

