from fastmcp import FastMCP
import logging
import random
from typing import Dict, List, Optional
import asyncio

# é…ç½®æ—¥å¿—
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(levelname)s - %(message)s'
)

app = FastMCP('oh-card-mcp-server')
logging.info('OHå¡MCPæœåŠ¡å™¨å·²åˆå§‹åŒ–')

# OHå¡æ•°æ®ç»“æ„ï¼ˆç®€åŒ–ç‰ˆï¼Œåªä¿ç•™å›¾ç‰‡URLï¼‰
OH_CARDS = {
    1: {
        "image_url": "https://cosmowind.github.io/oh-cards/images/card_01.png"
    },
    2: {
        "image_url": "https://cosmowind.github.io/oh-cards/images/card_02.png"
    },
    3: {
        "image_url": "https://cosmowind.github.io/oh-cards/images/card_03.png"
    },
    4: {
        "image_url": "https://cosmowind.github.io/oh-cards/images/card_04.png"
    },
    5: {
        "image_url": "https://cosmowind.github.io/oh-cards/images/card_05.png"
    },
    6: {
        "image_url": "https://cosmowind.github.io/oh-cards/images/card_06.png"
    },
    7: {
        "image_url": "https://cosmowind.github.io/oh-cards/images/card_07.png"
    },
    8: {
        "image_url": "https://cosmowind.github.io/oh-cards/images/card_08.png"
    },
    9: {
        "image_url": "https://cosmowind.github.io/oh-cards/images/card_09.png"
    }
}

# å¼•å¯¼é—®é¢˜åº“ï¼ˆä¿æŒä¸å˜ï¼‰
GUIDANCE_QUESTIONS = {
    "è§‚å¯Ÿæ„Ÿå—": [
        "çœ‹åˆ°äº†ä»€ä¹ˆï¼Ÿæ„Ÿå—å¦‚ä½•ï¼Ÿ",
        "æŠ½åˆ°çš„å¡ç‰Œä¸ä½ æœ€è¿‘å‘ç”Ÿçš„äº‹æˆ–æ„Ÿå—ç›¸å…³å—ï¼Ÿ",
        "ä½ è¯´å¡ç‰Œä¸­çš„ä¸¤ä¸ªä¸»è§’ï¼Œä»–ä»¬æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ",
        "è¿™å¼ å¡ç‰Œç»™ä½ çš„ç¬¬ä¸€å°è±¡æ˜¯ä»€ä¹ˆï¼Ÿ",
        "å¡ç‰Œä¸­æœ€å¸å¼•ä½ æ³¨æ„åŠ›çš„æ˜¯ä»€ä¹ˆï¼Ÿ"
    ],
    "æ·±å…¥æ¢ç´¢": [
        "æˆ‘å¾ˆå¥½å¥‡ï¼Œä½ ä¸ºä»€ä¹ˆä¼šè¿™æ ·æè¿°å®ƒï¼Ÿ",
        "ä½ æ³¨æ„åˆ°çš„è¿™ä¸ªç»†èŠ‚ï¼Œä½ è§‰å¾—å®ƒæ˜¯ä»€ä¹ˆï¼Ÿä»å“ªé‡Œæ¥çš„ï¼Ÿ",
        "ä½ è§‰å¾—è¿™ä¸ªäººåœ¨åšä»€ä¹ˆï¼Ÿtaåšè¿™ä»¶äº‹æœ‰ä»€ä¹ˆæ„Ÿå—ï¼Ÿ",
        "å¦‚æœä½ èƒ½å¬åˆ°å¡ç‰Œä¸­çš„å£°éŸ³ï¼Œä¼šæ˜¯ä»€ä¹ˆï¼Ÿ",
        "è¿™ä¸ªç”»é¢è®©ä½ æƒ³èµ·äº†ä»€ä¹ˆå›å¿†æˆ–ç»å†ï¼Ÿ"
    ],
    "æƒ…å¢ƒä»£å…¥": [
        "å¡ä¸­äººç‰©å¤„åœ¨ä»€ä¹ˆç¯å¢ƒä¸­ï¼Ÿç¯å¢ƒå¯¹taæœ‰ä»€ä¹ˆå½±å“ï¼Ÿ",
        "ä½ åœ¨è¿™ä¸ªå¡ç‰Œä¸­å—ï¼Ÿä½ æ˜¯é‡Œé¢çš„è°ï¼Ÿåœ¨åšä»€ä¹ˆï¼Ÿæ„Ÿå—å¦‚ä½•ï¼Ÿ",
        "ä½ çš„æ•…äº‹é‡Œï¼Œä¸»è§’é­é‡çš„äº‹æƒ…ï¼Œtaå¯ä»¥æ€ä¹ˆè§£å†³ï¼Ÿ",
        "å¦‚æœä½ æ˜¯å¡ç‰Œä¸­çš„ä¸»è§’ï¼Œä½ ä¼šé€‰æ‹©ä»€ä¹ˆè¡ŒåŠ¨ï¼Ÿ",
        "è¿™ä¸ªåœºæ™¯å¦‚æœå‘ç”Ÿåœ¨ä½ çš„ç”Ÿæ´»ä¸­ï¼Œä¼šæ˜¯ä»€ä¹ˆæ ·å­ï¼Ÿ"
    ],
    "å†…å¿ƒè¿æ¥": [
        "è¿™å¼ å¡ç‰Œåæ˜ äº†ä½ å†…å¿ƒçš„å“ªä¸ªéƒ¨åˆ†ï¼Ÿ",
        "å¡ç‰Œä¸­çš„æƒ…å¢ƒä¸ä½ å½“å‰çš„å¤„å¢ƒæœ‰ä»€ä¹ˆç›¸ä¼¼ä¹‹å¤„ï¼Ÿ",
        "ä»è¿™å¼ å¡ç‰Œä¸­ï¼Œä½ çœ‹åˆ°äº†ä»€ä¹ˆè§£å†³é—®é¢˜çš„å¯èƒ½æ€§ï¼Ÿ",
        "è¿™å¼ å¡ç‰Œæƒ³å‘Šè¯‰ä½ ä»€ä¹ˆé‡è¦çš„ä¿¡æ¯ï¼Ÿ",
        "å¦‚æœè¿™å¼ å¡ç‰Œæ˜¯ä¸€é¢é•œå­ï¼Œå®ƒç…§å‡ºäº†ä½ çš„ä»€ä¹ˆï¼Ÿ"
    ],
    "å¯å‘è¡ŒåŠ¨": [
        "è¿™å¼ å¡ç‰Œç»™äº†ä½ ä»€ä¹ˆå¯å‘æ¥å¤„ç†ä½ çš„å›°æƒ‘ï¼Ÿ",
        "æ ¹æ®å¡ç‰Œçš„æç¤ºï¼Œä½ å¯ä»¥é‡‡å–ä»€ä¹ˆå…·ä½“è¡ŒåŠ¨ï¼Ÿ",
        "è¿™å¼ å¡ç‰Œå¦‚ä½•å¸®åŠ©ä½ çœ‹å¾…å½“å‰çš„æŒ‘æˆ˜ï¼Ÿ",
        "ä»å¡ç‰Œä¸­å¾—åˆ°çš„æ´å¯Ÿï¼Œä½ å‡†å¤‡å¦‚ä½•åº”ç”¨åˆ°ç”Ÿæ´»ä¸­ï¼Ÿ",
        "è¿™æ¬¡æŠ½å¡ä½“éªŒè®©ä½ å¯¹è‡ªå·±æœ‰äº†ä»€ä¹ˆæ–°çš„è®¤è¯†ï¼Ÿ"
    ]
}

@app.tool()
async def what_is_oh_cards() -> Dict:
    """
    ä»‹ç»ä»€ä¹ˆæ˜¯OHå¡
    
    Returns:
        OHå¡çš„ä»‹ç»ä¿¡æ¯
    """
    info = {
        "title": "ä»€ä¹ˆæ˜¯OHå¡ï¼Ÿ",
        "description": "OHå¡ï¼ˆOpen Heart Cardsï¼‰æ˜¯ä¸€å¥—å¿ƒç†æŠ•å°„å·¥å…·ï¼Œé€šè¿‡å›¾åƒæ¥å¸®åŠ©äººä»¬æ¢ç´¢å†…å¿ƒä¸–ç•Œã€è·å¾—æ´å¯Ÿå’Œå¯å‘ã€‚",
        "features": [
            "ğŸ¯ æŠ•å°„å·¥å…·ï¼šé€šè¿‡å›¾åƒæŠ•å°„å†…å¿ƒçŠ¶æ€",
            "ğŸŒŸ è‡ªæˆ‘æ¢ç´¢ï¼šæ·±å…¥äº†è§£å†…åœ¨éœ€æ±‚å’Œæ„Ÿå—",
            "ğŸ’¡ å¯å‘æ€è€ƒï¼šä»æ–°è§’åº¦çœ‹å¾…é—®é¢˜å’ŒæŒ‘æˆ˜",
            "ğŸŒˆ æƒ…æ„Ÿè¡¨è¾¾ï¼šå¸®åŠ©è¡¨è¾¾éš¾ä»¥è¨€å–»çš„æ„Ÿå—",
            "ğŸ”® ç›´è§‰è¿æ¥ï¼šæ¿€æ´»å†…åœ¨æ™ºæ…§å’Œç›´è§‰"
        ],
        "principle": "OHå¡çš„æ ¸å¿ƒåŸç†æ˜¯'æŠ•å°„'â€”â€”æˆ‘ä»¬çœ‹åˆ°çš„ä¸ä»…ä»…æ˜¯å›¾åƒæœ¬èº«ï¼Œæ›´æ˜¯æˆ‘ä»¬å†…å¿ƒä¸–ç•Œçš„åæ˜ ã€‚æ¯ä¸ªäººå¯¹åŒä¸€å¼ å¡çš„è§£è¯»éƒ½æ˜¯ç‹¬ç‰¹çš„ï¼Œè¿™æ­£æ˜¯å®ƒçš„é­…åŠ›æ‰€åœ¨ã€‚",
        "benefits": [
            "è·å¾—æ–°çš„è§†è§’å’Œæ´å¯Ÿ",
            "é‡Šæ”¾å†…åœ¨æ™ºæ…§",
            "ä¿ƒè¿›è‡ªæˆ‘è§‰å¯Ÿ",
            "æ¿€å‘åˆ›é€ æ€§æ€ç»´",
            "æ‰¾åˆ°è§£å†³é—®é¢˜çš„çµæ„Ÿ"
        ]
    }
    
    logging.info('ç”¨æˆ·æŸ¥è¯¢äº†OHå¡çš„ä»‹ç»ä¿¡æ¯')
    return info

@app.tool()
async def get_oh_card_process() -> Dict:
    """
    è·å–OHå¡æŠ½å–æµç¨‹
    
    Returns:
        å®Œæ•´çš„OHå¡ä½“éªŒæµç¨‹
    """
    process = {
        "title": "OHå¡æŠ½å–æµç¨‹",
        "subtitle": "è·Ÿéšè¿™5ä¸ªæ­¥éª¤ï¼Œå¼€å¯ä¸€æ®µå†…å¿ƒæ¢ç´¢ä¹‹æ—…",
        "steps": [
            {
                "step": 1,
                "name": "ç¡®å®šå¿ƒä¸­çš„å¡ç‚¹",
                "description": "æ€è€ƒä½ æœ€è¿‘é‡åˆ°çš„å›°æƒ‘æˆ–é—®é¢˜",
                "guidance": "é™ä¸‹å¿ƒæ¥ï¼Œæƒ³æƒ³æœ€è¿‘è®©ä½ å›°æ‰°ã€è¿·èŒ«æˆ–æƒ³è¦æ·±å…¥äº†è§£çš„äº‹æƒ…ã€‚å¯ä»¥æ˜¯æƒ…æ„Ÿé—®é¢˜ã€äººé™…å…³ç³»ã€å·¥ä½œé€‰æ‹©ã€äººç”Ÿæ–¹å‘ç­‰ä»»ä½•è®©ä½ æ„Ÿåˆ°éœ€è¦æŒ‡å¼•çš„è¯é¢˜ã€‚",
                "action": "åœ¨å¿ƒä¸­æ˜ç¡®ä½ æƒ³è¦æ¢ç´¢çš„é—®é¢˜"
            },
            {
                "step": 2,
                "name": "å‡èšå®‡å®™èƒ½é‡",
                "description": "æŠ½å–ä½ çš„OHå¡",
                "guidance": "å¸¦ç€ä½ çš„é—®é¢˜ï¼Œæ·±å‘¼å¸å‡ æ¬¡ï¼Œè®©è‡ªå·±çš„æ„è¯†ä¸å®‡å®™èƒ½é‡è¿æ¥ã€‚å½“ä½ æ„Ÿåˆ°å‡†å¤‡å¥½æ—¶ï¼ŒæŠ½å–ä½ çš„OHå¡ã€‚ç›¸ä¿¡ç›´è§‰çš„æŒ‡å¼•ï¼Œç¬¬ä¸€å¼ æŠ½åˆ°çš„å¡å°±æ˜¯ä¸ºä½ è€Œæ¥çš„ã€‚",
                "action": "ä½¿ç”¨'draw_oh_card'åŠŸèƒ½æŠ½å–ä½ çš„ä¸“å±å¡ç‰Œ"
            },
            {
                "step": 3,
                "name": "é—®é¢˜å¼•å¯¼",
                "description": "è®©è‡ªå·±ä»£å…¥å›¾ç‰‡ä¸­",
                "guidance": "ä»”ç»†è§‚å¯Ÿä½ çš„å¡ç‰Œï¼Œè®©å›¾åƒè‡ªç„¶åœ°ä¸ä½ çš„å†…å¿ƒäº§ç”Ÿå…±é¸£ã€‚ä¸è¦æ€¥äºåˆ†æï¼Œå…ˆæ„Ÿå—å›¾åƒç»™ä½ å¸¦æ¥çš„ç¬¬ä¸€å°è±¡å’Œæƒ…æ„Ÿååº”ã€‚",
                "action": "ä½¿ç”¨'get_guidance_questions'è·å–å¼•å¯¼é—®é¢˜ï¼Œå¸®åŠ©ä½ æ·±å…¥æ¢ç´¢"
            },
            {
                "step": 4,
                "name": "å¯»æ‰¾å¯å‘",
                "description": "ä»å›¾ç‰‡ä¸é—®é¢˜ä¸­æ‰¾åˆ°è§£å†³å¡ç‚¹çš„å¯å‘",
                "guidance": "é€šè¿‡å›ç­”å¼•å¯¼é—®é¢˜ï¼Œå°†å¡ç‰Œçš„æ„è±¡ä¸ä½ çš„çœŸå®å¤„å¢ƒè¿æ¥èµ·æ¥ã€‚æ¢ç´¢å›¾åƒä¸­çš„è±¡å¾æ„ä¹‰ï¼Œå¯»æ‰¾å®ƒå¯¹ä½ é—®é¢˜çš„å¯ç¤ºå’ŒæŒ‡å¼•ã€‚",
                "action": "æ·±å…¥æ€è€ƒå¹¶å›ç­”å¼•å¯¼é—®é¢˜ï¼Œå‘ç°å†…åœ¨æ™ºæ…§"
            },
            {
                "step": 5,
                "name": "å®Œæˆä½“éªŒ",
                "description": "æ‹¿èµ°ä½ çš„çºªå¿µå¡",
                "guidance": "æ€»ç»“è¿™æ¬¡æŠ½å¡ä½“éªŒç»™ä½ çš„å¯å‘å’Œæ´å¯Ÿã€‚è®°å½•ä¸‹é‡è¦çš„æ„Ÿæ‚Ÿï¼Œå¹¶æ€è€ƒå¦‚ä½•å°†è¿™äº›æ´å¯Ÿåº”ç”¨åˆ°ä½ çš„å®é™…ç”Ÿæ´»ä¸­ã€‚",
                "action": "ä¿å­˜å¡ç‰Œä¿¡æ¯ä½œä¸ºçºªå¿µï¼Œè®©è¿™ä»½æ™ºæ…§ä¼´éšä½ å‰è¡Œ"
            }
        ],
        "tips": [
            "ğŸ’« ä¿æŒå¼€æ”¾çš„å¿ƒæ€ï¼Œç›¸ä¿¡ç›´è§‰çš„æŒ‡å¼•",
            "ğŸŒŸ æ²¡æœ‰æ ‡å‡†ç­”æ¡ˆï¼Œä½ çš„æ„Ÿå—æœ€é‡è¦",
            "ğŸ’­ æ…¢æ…¢æ¥ï¼Œç»™è‡ªå·±å……åˆ†çš„æ—¶é—´æ„Ÿå—",
            "ğŸ“ è®°å½•ä¸‹é‡è¦çš„æ´å¯Ÿå’Œå¯å‘",
            "ğŸ”„ å¿…è¦æ—¶å¯ä»¥é‡æ–°æŠ½å¡ï¼Œç›´åˆ°æ‰¾åˆ°å…±é¸£"
        ]
    }
    
    logging.info('ç”¨æˆ·æŸ¥è¯¢äº†OHå¡æŠ½å–æµç¨‹')
    return process

@app.tool()
async def draw_oh_card(intention: str = "") -> Dict:
    """
    æŠ½å–ä¸€å¼ OHå¡
    
    Args:
        intention: ç”¨æˆ·çš„æ„å›¾æˆ–æƒ³è¦æ¢ç´¢çš„é—®é¢˜ï¼ˆå¯é€‰ï¼‰
    
    Returns:
        æŠ½å–çš„å¡ç‰Œä¿¡æ¯ï¼ˆä»…åŒ…å«å›¾ç‰‡URLï¼‰
    """
    card_id = random.randint(1, 9)
    card = OH_CARDS[card_id].copy()
    card['card_id'] = card_id
    card['draw_time'] = "åˆšåˆš"
    
    # ç®€åŒ–è¿”å›ä¿¡æ¯ï¼Œåªä¿ç•™å›¾ç‰‡URLå’ŒåŸºæœ¬å¼•å¯¼
    result = {
        "card_id": card_id,
        "image_url": card["image_url"],
        "draw_time": card["draw_time"],
        "message": f"ä½ çš„OHå¡å·²ç»æŠ½å–å®Œæˆï¼è¯·ç‚¹å‡»æŸ¥çœ‹å›¾ç‰‡ï¼š{card['image_url']}",
        "guidance": "ä»”ç»†è§‚å¯Ÿè¿™å¼ å¡ç‰Œï¼Œè®©å›¾åƒä¸ä½ çš„å†…å¿ƒäº§ç”Ÿå…±é¸£ã€‚ä½ å¯ä»¥ä½¿ç”¨'get_guidance_questions'åŠŸèƒ½è·å–å¼•å¯¼é—®é¢˜æ¥æ·±å…¥æ¢ç´¢ã€‚"
    }
    
    if intention:
        result['user_intention'] = intention
        result['connection_hint'] = f"è¿™å¼ å¡ç‰Œå‡ºç°åœ¨ä½ å…³äº'{intention}'çš„è¯¢é—®ä¸­ï¼Œè¯·ä»”ç»†è§‚å¯Ÿå›¾åƒï¼Œå®ƒå¯èƒ½åŒ…å«äº†ä½ éœ€è¦çš„ç­”æ¡ˆã€‚"
    
    logging.info(f'ç”¨æˆ·æŠ½å–äº†å¡ç‰Œ ID: {card_id}, æ„å›¾: {intention or "æœªæŒ‡å®š"}')
    return result

@app.tool()
async def get_guidance_questions(question_type: str = "random") -> Dict:
    """
    è·å–å¼•å¯¼é—®é¢˜æ¥å¸®åŠ©ç”¨æˆ·æ¢ç´¢å¡ç‰Œ
    
    Args:
        question_type: é—®é¢˜ç±»å‹ ("è§‚å¯Ÿæ„Ÿå—", "æ·±å…¥æ¢ç´¢", "æƒ…å¢ƒä»£å…¥", "å†…å¿ƒè¿æ¥", "å¯å‘è¡ŒåŠ¨", "random")
    
    Returns:
        ç›¸åº”ç±»å‹çš„å¼•å¯¼é—®é¢˜
    """
    if question_type == "random" or question_type not in GUIDANCE_QUESTIONS:
        # éšæœºé€‰æ‹©ä¸€ä¸ªç±»å‹
        question_type = random.choice(list(GUIDANCE_QUESTIONS.keys()))
    
    questions = GUIDANCE_QUESTIONS[question_type]
    selected_questions = random.sample(questions, min(3, len(questions)))
    
    guidance = {
        "question_type": question_type,
        "questions": selected_questions,
        "usage_tip": "é€‰æ‹©ä¸€ä¸ªæœ€å¸å¼•ä½ çš„é—®é¢˜å¼€å§‹ï¼Œæ…¢æ…¢åœ°ã€æ·±å…¥åœ°æ€è€ƒã€‚ä¸è¦æ€¥äºå›ç­”æ‰€æœ‰é—®é¢˜ï¼Œé‡è¦çš„æ˜¯è´¨é‡è€Œéæ•°é‡ã€‚",
        "type_description": {
            "è§‚å¯Ÿæ„Ÿå—": "å¸®åŠ©ä½ è§‚å¯Ÿå¡ç‰Œå¹¶æ„Ÿå—ç¬¬ä¸€å°è±¡",
            "æ·±å…¥æ¢ç´¢": "å¼•å¯¼ä½ æ·±å…¥æŒ–æ˜å¡ç‰Œçš„ç»†èŠ‚å’Œå«ä¹‰",
            "æƒ…å¢ƒä»£å…¥": "è®©ä½ èå…¥å¡ç‰Œæƒ…å¢ƒï¼Œè·å¾—èº«ä¸´å…¶å¢ƒçš„ä½“éªŒ",
            "å†…å¿ƒè¿æ¥": "å»ºç«‹å¡ç‰Œä¸ä½ å†…å¿ƒä¸–ç•Œçš„è”ç³»",
            "å¯å‘è¡ŒåŠ¨": "ä»å¡ç‰Œä¸­è·å¾—å®é™…çš„ç”Ÿæ´»æŒ‡å¯¼"
        }.get(question_type, "ç»¼åˆæ€§é—®é¢˜"),
        "next_steps": [
            "æ·±å…¥æ€è€ƒé€‰ä¸­çš„é—®é¢˜",
            "å¯ä»¥ä½¿ç”¨'get_guidance_questions'è·å–å…¶ä»–ç±»å‹çš„é—®é¢˜",
            "å®Œæˆæ¢ç´¢åå¯ä»¥è®°å½•ä½ çš„æ„Ÿæ‚Ÿå’Œæ´å¯Ÿ"
        ]
    }
    
    logging.info(f'ä¸ºç”¨æˆ·æä¾›äº†{question_type}ç±»å‹çš„å¼•å¯¼é—®é¢˜')
    return guidance

@app.tool()
async def get_all_question_types() -> Dict:
    """
    è·å–æ‰€æœ‰å¼•å¯¼é—®é¢˜ç±»å‹
    
    Returns:
        æ‰€æœ‰é—®é¢˜ç±»å‹çš„è¯´æ˜
    """
    types_info = {
        "title": "å¼•å¯¼é—®é¢˜ç±»å‹",
        "description": "ä¸åŒç±»å‹çš„é—®é¢˜å¸®åŠ©ä½ ä»ä¸åŒè§’åº¦æ¢ç´¢å¡ç‰Œ",
        "types": []
    }
    
    type_descriptions = {
        "è§‚å¯Ÿæ„Ÿå—": {
            "description": "å¸®åŠ©ä½ è§‚å¯Ÿå¡ç‰Œå¹¶æ„Ÿå—ç¬¬ä¸€å°è±¡",
            "purpose": "å»ºç«‹ä¸å¡ç‰Œçš„åˆå§‹è¿æ¥",
            "example": "çœ‹åˆ°äº†ä»€ä¹ˆï¼Ÿæ„Ÿå—å¦‚ä½•ï¼Ÿ"
        },
        "æ·±å…¥æ¢ç´¢": {
            "description": "å¼•å¯¼ä½ æ·±å…¥æŒ–æ˜å¡ç‰Œçš„ç»†èŠ‚å’Œå«ä¹‰",
            "purpose": "å‘ç°æ›´å¤šéšè—çš„ä¿¡æ¯å’Œè±¡å¾",
            "example": "ä½ æ³¨æ„åˆ°çš„è¿™ä¸ªç»†èŠ‚ï¼Œä½ è§‰å¾—å®ƒæ˜¯ä»€ä¹ˆï¼Ÿ"
        },
        "æƒ…å¢ƒä»£å…¥": {
            "description": "è®©ä½ èå…¥å¡ç‰Œæƒ…å¢ƒï¼Œè·å¾—èº«ä¸´å…¶å¢ƒçš„ä½“éªŒ",
            "purpose": "é€šè¿‡è§’è‰²æ‰®æ¼”è·å¾—æ›´æ·±å±‚çš„ç†è§£",
            "example": "ä½ åœ¨è¿™ä¸ªå¡ç‰Œä¸­å—ï¼Ÿä½ æ˜¯é‡Œé¢çš„è°ï¼Ÿ"
        },
        "å†…å¿ƒè¿æ¥": {
            "description": "å»ºç«‹å¡ç‰Œä¸ä½ å†…å¿ƒä¸–ç•Œçš„è”ç³»",
            "purpose": "å°†å¡ç‰Œä¸ä¸ªäººç»å†å’Œæ„Ÿå—è¿æ¥",
            "example": "è¿™å¼ å¡ç‰Œåæ˜ äº†ä½ å†…å¿ƒçš„å“ªä¸ªéƒ¨åˆ†ï¼Ÿ"
        },
        "å¯å‘è¡ŒåŠ¨": {
            "description": "ä»å¡ç‰Œä¸­è·å¾—å®é™…çš„ç”Ÿæ´»æŒ‡å¯¼",
            "purpose": "å°†æ´å¯Ÿè½¬åŒ–ä¸ºå…·ä½“çš„è¡ŒåŠ¨æ–¹æ¡ˆ",
            "example": "æ ¹æ®å¡ç‰Œçš„æç¤ºï¼Œä½ å¯ä»¥é‡‡å–ä»€ä¹ˆå…·ä½“è¡ŒåŠ¨ï¼Ÿ"
        }
    }
    
    for type_name, info in type_descriptions.items():
        types_info["types"].append({
            "type": type_name,
            "description": info["description"],
            "purpose": info["purpose"],
            "example": info["example"]
        })
    
    types_info["usage_tip"] = "å»ºè®®æŒ‰é¡ºåºè¿›è¡Œï¼šè§‚å¯Ÿæ„Ÿå— â†’ æ·±å…¥æ¢ç´¢ â†’ æƒ…å¢ƒä»£å…¥ â†’ å†…å¿ƒè¿æ¥ â†’ å¯å‘è¡ŒåŠ¨ï¼Œè¿™æ ·èƒ½è·å¾—æœ€å®Œæ•´çš„æ¢ç´¢ä½“éªŒã€‚"
    
    logging.info('ç”¨æˆ·æŸ¥è¯¢äº†æ‰€æœ‰å¼•å¯¼é—®é¢˜ç±»å‹')
    return types_info

@app.tool()
async def get_all_cards_preview() -> Dict:
    """
    è·å–æ‰€æœ‰OHå¡çš„é¢„è§ˆä¿¡æ¯ï¼ˆä»…æ˜¾ç¤ºå›¾ç‰‡URLï¼‰
    
    Returns:
        æ‰€æœ‰å¡ç‰Œçš„å›¾ç‰‡URL
    """
    cards_preview = []
    for card_id, card_data in OH_CARDS.items():
        preview = {
            "card_id": card_id,
            "image_url": card_data["image_url"]
        }
        cards_preview.append(preview)
    
    preview_info = {
        "total_cards": len(cards_preview),
        "cards": cards_preview,
        "message": "è¿™é‡Œæ˜¯æ‰€æœ‰OHå¡çš„å›¾ç‰‡é“¾æ¥ã€‚ç‚¹å‡»ä»»æ„é“¾æ¥æŸ¥çœ‹å¡ç‰Œå›¾ç‰‡ï¼Œä½†å»ºè®®é€šè¿‡æŠ½å¡åŠŸèƒ½æ¥è·å¾—æ›´å¥½çš„æ¢ç´¢ä½“éªŒï¼"
    }
    
    logging.info('ç”¨æˆ·æŸ¥çœ‹äº†æ‰€æœ‰å¡ç‰Œçš„é¢„è§ˆä¿¡æ¯')
    return preview_info

if __name__ == '__main__':
    logging.info('å¼€å§‹å¯åŠ¨OHå¡MCPæœåŠ¡å™¨...')
    app.run()